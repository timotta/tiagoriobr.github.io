<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="author" content="author">

<meta name="generator" content="mynt v0.4">

<link rel="alternate" href="/feed.xml" type="application/atom+xml">
<link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&family=Ubuntu:ital,wght@0,400;0,700;1,400;1,700&display=swap">
<link rel="stylesheet" href="/assets/css/screen.css">
<link rel="stylesheet" href="/assets/css/pygments.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="/assets/js/mynt.min.js"></script>


    <title>A fantástica fábrica de widgets : Blog – title</title>
</head>

<body>
    <div id="container">
        <div id="sidebar">
            <h1 id="title"><a href="/">title</a></h1>
            <h2 id="subtitle">subtitle</h2>

            <ul id="nav">
                <li><a href="/">Blog</a></li>
                <li><a href="/archives/">Archives</a></li>
                <li><a href="/feed.xml">Feed</a></li>
            </ul>

            <p>This is a convenient place to put a quick blurb about yourself and the purpose of this site.</p>
            <p>This is also a good place to list any other sites you are on like <a href="https://github.com/">GitHub</a> and <a href="https://twitter.com/">Twitter</a>.</p>
            <p><code>/_templates/layout.html#L22-24</code></p>

            <div id="footer">
                <p>© 2023 author – powered by <a href="https://mynt.uhnomoli.com/">mynt</a></p>
            </div>
        </div>

        
    <ul id="breadcrumbs">
        <li><a href="/">Blog</a></li>
        <li>A fantástica fábrica de widgets</li>
    </ul>


        <div id="content">
            
    <div class="post">
        <h1 class="post-title">A fantástica fábrica de widgets</h1>
        <h2 class="post-meta">Wednesday, April 26, 2023 <span>»</span> <a href="/archives/globocom/">globocom</a>, <a href="/archives/webmedia/">webmedia</a></h2>

        <p>Ess história aqui demonstra como a falta de flexibilidade e autonomia na infra estrutura de peodução pode gerar belas gambiarras.</p>

<p>Na Globo.com tinhamos diversos sites diferentes, o G1 de noticias, Ge de esportes, Ego, Entretenimento (na época não havia GShow). Em geral esses sites exibiam apenas noíticias na época, e todo acervo de vídeos estava concentrado num produto chamado GMC, globo media center.</p>

<p>A idéia era acabar com esse silo, provendo uma maneira simples dos produtos oferecerem os videos cadastrados no GMC. Uma API (que chamavamos de WebmediaAPI) já estava disponível, mas ela não padronizava a exibição dessas ofertas de conteúdo.</p>

<p>A solução proposta seria desenvolvermos widgets para que os desenvolvedores de cada site pudessem instanciar em suas homes. Esses widgets seriam ofertas como videos recentes, mais vistos, melhor avaliados, com possibilidade de diversos filtros e algumas opções de layout.</p>

<p>Naquele tempo os sites da Globo.com usavam uma plataforma chamada vignette que estatizava todo seu conteudo. As materias eram html estaticos gerados após cada publicação, e as homes idem. Era necessario uma publicação do editor para ela alterar.</p>

<p>Isso ia contra a dinamicidade do conteúdo de videos. Como manter um mais vistos de uma determinada categoria por exemplo, ecologia, em uma materia estatizada?</p>

<p>Uma maneira seria usar server side include, visto que os arquivos estaticos eram servidos pelo apache. Mas, infelizmente havia muitas restrições para fazer qualquer mudança em infra estrutura na globo.com naquela época.</p>

<p>Nos sobrou então fazer widgets client side. Contudo, requisições cross domain para obter as informações da WebmediaApi só seriam possiveis se pudessemos prover os headers necessários de CORS. Mas pra fazer isso também seria necessário mudanças na infra visto que a camada (apache) na frente da WebmediaApi também era rígida, fora de nosso controle e trocava todos os headers.</p>

<p>Nossa solução final foi permitir à webmedia api retornar o seu conteudo com uma chamada a uma função callback fornecida.</p>

<p>Tinhamos um javascript com o codigo do widget e este javascript incluia outro &ldquo;javascript&rdquo; que era a chamada à WebmediaAPI mandando como parametro uma função dinamica. Essa função recebia o conteudo da WebmediaApi e renderizava o widget escolhido e customizado.</p>

<p>Havia até um controle de timeout em caso de demora pro callback responder utilizando o setTimeout do javascript.</p>

<p>Isso resolveu nosso problema e por alguns sprints fizemos uma verdadeira fabrica de widgets. As necessidades e ideias vinham e a gente gerava widget e filtros necessarios na webmediaapi. Foi um sucesso.</p>

<p>Até que resolvemos fazer o Globo Videos. Site sucessor e condensador de todoss os videos que também estariam espalhados nos outros sites. Oras, com todos os widgets, seria simples criar o site. Bastariamos encaixá-los em algumas páginas e correr pro abraço.</p>

<p>Mas havia um porém&hellip;</p>

<p>Naquela época o google não indexava páginas renderizadas via javascript. E precisávamos que ao menos o Globo Videos renderizasse no servidor.</p>

<p>A solução: passamos a renderizar os widgets feitos em javascript no servidor. Como tudo no vignette era java, tivemos que renderizar usandl Rhino (antes do java 1.5 só dava pra renderizar javascript assim).</p>

<p>Para manter o frescor dos dados as homes do globo videos passaram a ser renderizadas no servidor a cada X tempos. Eu não lembro se essa publicação automatica tinha sido feita via cron ou via alguma ferramenta do vignette, mas o ponto é que o html estático passou a ser gerado frequentemente, com o html dos widgets.</p>

<p>As paginas dos videos continuaram exibindo os widgets client side pois seria impraticavel renderizar milhoes de html frequentemente.</p>

<p>Uma dificuldade adicional dessa solução foi que tudo na globo.com na epoca rodava em um weblogic, e ele já possuia uma Rhino versão velha dentro dele que se sobrepunha ao nosso Rhino versão mais nova. Para renderizar então os widgets foi necessário executar os codigo instanciando um outro classloader.</p>

    </div>

        </div>
    </div>
</body>
</html>